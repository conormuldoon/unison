

<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>JSDoc: Unison.js</title>

    <script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="./build/entry.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link href="https://fonts.googleapis.com/css?family=Muli:100,400,700|Oswald:300|Inconsolata,700" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
    <link type="text/css" rel="stylesheet" href="https://jmblog.github.io/color-themes-for-google-code-prettify/themes/tomorrow-night.min.css">
    <link type="text/css" rel="stylesheet" href="styles/app.min.css">
    <link type="text/css" rel="stylesheet" href="styles/iframe.css">
</head>

<body>
    <div id="stickyNavbarOverlay"></div>
    <div class="top-navbar">
        <div class="container">
            <nav class="navbar" role="navigation" aria-label="main navigation">
                <div class="navbar-brand">
                    
                     
                        <h1 class="navbar-item">Unison React components</h1>
                    
                    <a id="hamburger" role="button" class="navbar-burger" aria-label="menu" aria-expanded="false">
                        <span aria-hidden="true"></span>
                        <span aria-hidden="true"></span>
                        <span aria-hidden="true"></span>
                    </a>
                </div>
                
            </nav>
        </div>
    </div>
    <div class="container">
        <div class="columns">
            <div class="column is-3" id="sidebarNav">
                <div class="sidebar">
                    <nav>
                        <h2><a href="index.html">Home</a></h2><div class="category"><h3>Components</h3><ul><li><a href="ARLocationComponent.html">ARLocationComponent</a></li><li><a href="ChartComponent.html">ChartComponent</a></li><li><a href="ChartPopup.html">ChartPopup</a></li><li><a href="DateSelector.html">DateSelector</a></li><li><a href="LeafletMap.html">LeafletMap</a></li><li><a href="LocationForm.html">LocationForm</a></li><li><a href="RemoveForm.html">RemoveForm</a></li><li><a href="TabsComponent.html">TabsComponent</a></li><li><a href="Unison.html">Unison</a></li></ul></div>
                    </nav>
                </div>
            </div>
            <div class="column is-9-desktop">
                <div class="content" id="main-content-wrapper">
                    <header class="page-title">
                        <p>Source</p>
                        <h1>Unison.js</h1>
                    </header>
                    
                    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>

import React, { Component } from 'react';

import './App.css';

import 'react-day-picker/lib/style.css';

import DateSelector from './DateSelector';

import ARLocationComponent from './ARLocationComponent';

import LeafletMap from './LeafletMap';
import {FORMAT,API} from './Constant';
import {TODAY,FROM_DATE} from './Util';
import PropTypes from 'prop-types';

import  {
  formatDate
} from 'react-day-picker/moment';

let maxLen;
const WSPACE='\u00a0';
const varOpt=['Precipitation','Humidity','Wind Direction','Wind Speed','Cloudiness','Cloud Level','Dew Point','Pressure','Temperature'];
    
/**
 * Application component for Unison. Once mounted, it connects to the back-end to receive a list of the locations being tracked.
 * 
 * @component
 * 
 */
class Unison extends Component {


  constructor(props) {
    super(props);

    this.state = {
      fromDate: FROM_DATE,
      toDate: TODAY,
      option: undefined,
      marker: undefined,
      clickedLocation: undefined,
      curVar: 'Precipitation',
      curLoc: undefined,
    };
  }

  componentDidMount = () => {
    this.cancelObtainData=this.obtainData();
  }

  componentWillUnmount = () => {
    this.cancelObtainData();
  }

  obtainData = () => {

    let active=true;

    new Promise(async () =>{
      let response = await fetch(API+'/location');

      if(response.ok){
        let locationArray = await response.json();

        if(active){
          let n=locationArray.length;

          let newOption=[];
          let newMarker=[];

          maxLen=0;
          for(let i=0;i&lt;n;i++){
            maxLen=Math.max(locationArray[i].name.length)

          }
          for(let i=0;i&lt;n;i++){
            newOption.push(this.addPadding(locationArray[i].name));
            let pos=[locationArray[i].geom.coordinates[1],locationArray[i].geom.coordinates[0]];

            newMarker.push({name:locationArray[i].name,position:pos});


          }
          if(n>0){
            this.setState({option:newOption,marker:newMarker,curLoc: this.addPadding(locationArray[0].name) });
          }else{
            this.setState({curLoc: undefined,option:undefined,marker:undefined});
          }
        }
      }
    });

    const cancel = () => active = false;
    return cancel;

  }

  markerClicked = (location) => {

    let newLoc=this.addPadding(location,maxLen);
    this.setState({clickedLocation:newLoc,curLoc:newLoc});
  }

  _onLocationSelect = (event) =>{

    this.setState({curLoc: event.target.value});
  }

  _onVarSelect = (event) =>{
    this.setState({curVar: event.target.value});
  }

  removePadding = (location) =>{

    if(location!==undefined){

      const n=location.length;
      for(let i=0;i&lt;n;i++){
        if(location.charAt(i)===WSPACE){
          if(i===n-1||location.charAt(i+1)===WSPACE){
              return location.substring(0,i);
          }
        }

      }
      
    }
    return location;
  }

  addPadding = (location) =>{
    let num=maxLen-location.length;
    let newLoc=location;

    for(let i=0;i&lt;num;i++){
      newLoc=newLoc.concat(WSPACE);
    }

    return newLoc;
  }

  handleStartChange = (selectedDate) => {
    this.setState({ fromDate: formatDate(selectedDate,FORMAT) });
  }

  handleEndChange = (selectedDate) => {
    this.setState({ toDate: formatDate(selectedDate,FORMAT) });
  }


  test = (event) =>{
    alert('hello '+event.target.value);
  }

  render() {


    return (


      &lt;div id="mapdiv">

      &lt;div id="logos">

          &lt;center>
            &lt;img id="logoitem" alt="" src={this.props.logoLeft} />


            &lt;img id="logoitem" alt="" src={this.props.logoRight} />
          &lt;/center>

      &lt;/div>

      &lt;LeafletMap marker={this.state.marker} curVar={this.state.curVar} curLoc={this.state.curLoc} 
          markerCallback={this.markerClicked} fromDate={this.state.fromDate} toDate={this.state.toDate} 
          mapCentre={this.props.mapCentre}
          
          />
      &lt;div id="selectdiv" >

        &lt;center>

          &lt;div>
            &lt;div id='variDD' >

                &lt;select disabled={!this.state.curLoc} onChange={this._onVarSelect}>

                    {varOpt.map((opt) => &lt;option key={opt} value={opt}>{opt}&lt;/option>)}

                &lt;/select>

            &lt;/div>

            &lt;div className='marginItem' >

                &lt;select disabled={!this.state.curLoc} onChange={this._onLocationSelect} defaultValue="Location" value={this.state.curLoc}>
                    {!this.state.option&amp;&amp;&lt;option key="Location" value="Location" >Location&lt;/option>}
                    {this.state.option&amp;&amp;this.state.option.map((opt) => &lt;option key={opt} value={opt}>{opt}&lt;/option>)}

                &lt;/select>

              
            &lt;/div>


            &lt;div className='pLeft' >
              &lt;DateSelector 
                label="From date" dateValue={this.state.fromDate}
                handleDayChange={this.handleStartChange}
              />
            &lt;/div>

            &lt;div className='pLeft' >
              &lt;DateSelector
                label="To date" dateValue={this.state.toDate}
                handleDayChange={this.handleEndChange}
              />

            &lt;/div>

          



            &lt;a className='pLeft'  href={API+'/csv'+this.state.curVar.replace(/ /g,'')+'?location='+this.removePadding(this.state.curLoc)+'&amp;fromDate='+this.state.fromDate+'&amp;toDate='+this.state.toDate}>

              &lt;button disabled={!this.state.curLoc} >
                CSV
              &lt;/button>

            &lt;/a>
          &lt;/div>

          &lt;ARLocationComponent obtainData={this.obtainData} location={this.removePadding(this.state.curLoc)}/>

        &lt;/center>

      &lt;/div>



      &lt;/div>
    );
  }
}

Unison.propTypes ={

   /** The latitude/longitude coordinates for the centre of the map. */
   mapCentre: PropTypes.array.isRequired,

  /** A logo displayed at the bottom of the screen. It will be displayed to the left
   * if the logoRight prop is defined.
   */
  logoLeft: PropTypes.any,

  /** A logo displayed at the bottom of the screen. It will be displayed to the right
   * if the logoLeft prop is defined.
   */
  logoRight: PropTypes.any,

}

export default Unison;
</code></pre>
        </article>
    </section>




                </div>
            </div>
        </div>
    </div>

<footer class="footer">
    <div class="content has-text-centered">
        <p>Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.3</a> on Wed Oct 16 2019 15:40:45 GMT+0100 (Irish Standard Time)</p>
        <p class="sidebar-created-by">
            <a href="https://github.com/SoftwareBrothers/better-docs" target="_blank">BetterDocs theme</a> provided with <i class="fas fa-heart"></i> by 
            <a href="http://softwarebrothers.co" target="_blank">SoftwareBrothers - JavaScript Development Agency</a>
        </p>
    </div>
</footer>

<script src="scripts/app.min.js"></script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
